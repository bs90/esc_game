<div class="flex flex-col items-center my-4 w-full">
  <h1 class="text-2xl font-bold mb-6">My Items</h1>

  <div class="w-full grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 2xl:grid-cols-4">
    <% @items.each do |item| %>
      <div class="bg-white rounded-xl shadow p-4 text-center w-full aspect-square flex flex-col justify-center items-center">
        <div class="mb-3">
          <div class="mb-3">
            <% if item.is_collected %>
              <%= image_tag item.image_url,
                  class: "w-60 h-60 mb-2 rounded-lg object-cover cursor-pointer hover:opacity-80 transition-opacity",
                  onerror: "this.style.display='none'; this.nextElementSibling.style.display='block';",
                  onclick: "openImageModal('#{item.image_url}', '')"
              %>
            <% else %>
              <p class="text-gray-500">?</p>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-6">
    <%= link_to "Back to Home", root_path, class: "bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg" %>
  </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
  <div class="relative max-w-4xl max-h-full p-4">
    <button onclick="closeImageModal()" class="absolute top-2 right-2 text-white text-2xl font-bold hover:text-gray-300 z-10">
      Ã—
    </button>
    <div class="text-center">
      <h3 id="modalTitle" class="text-white text-xl font-bold mb-4"></h3>
      <img id="modalImage" src="" alt="" class="max-w-full max-h-[80vh] object-contain rounded-lg">
    </div>
  </div>
</div>

<script>
function openImageModal(imageUrl, title) {
  document.getElementById('modalImage').src = imageUrl;
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('imageModal').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function closeImageModal() {
  document.getElementById('imageModal').classList.add('hidden');
  document.body.style.overflow = 'auto';
}

// Close modal when clicking outside the image
document.getElementById('imageModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeImageModal();
  }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeImageModal();
  }
});
</script>
